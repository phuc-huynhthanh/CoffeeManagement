<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>POS - Qu·∫£n l√Ω b√°n h√†ng</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex flex-col min-h-screen">
  <!-- Header -->
  <header class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-8 py-4 flex justify-between items-center shadow-md">
    <h1 class="text-2xl font-bold tracking-wide">‚òï POS - Coffee Management</h1>
    <div class="flex gap-3 items-center">
      <input id="search" type="text" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..."
             class="px-4 py-2 rounded-lg text-gray-800 w-64 focus:outline-none focus:ring-2 focus:ring-yellow-400">
      <select id="filter" class="px-3 py-2 rounded-lg text-gray-800">
        <option value="">T·∫•t c·∫£ lo·∫°i</option>
        <% loai.forEach(l => { %>
          <option value="<%= l %>"><%= l %></option>
        <% }) %>
      </select>
    </div>
  </header>

  <!-- N·ªôi dung -->
  <div class="flex flex-1 overflow-hidden">
    <!-- Danh s√°ch s·∫£n ph·∫©m -->
    <main id="product-list" class="flex-1 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-5 gap-6 p-6 overflow-y-auto">
      <% sanPham.forEach(p => { %>
        <div 
          class="product bg-white rounded-2xl shadow hover:shadow-xl hover:scale-105 transform transition cursor-pointer flex flex-col items-center text-center p-4"
          data-id="<%= p.san_pham_id %>"
          data-ten="<%= p.ten_san_pham %>"
          data-gia="<%= p.gia_co_ban %>"
          data-loai="<%= p.ten_loai %>"
        >
          <img src="<%= p.hinh_anh %>" alt="<%= p.ten_san_pham %>" 
               class="w-28 h-28 object-cover rounded-xl mb-3">
          <h3 class="text-lg font-semibold text-gray-800"><%= p.ten_san_pham %></h3>
          <p class="text-gray-500 text-sm mb-1"><%= p.ten_loai %></p>
          <p class="text-blue-600 font-bold"><%= Number(p.gia_co_ban).toLocaleString() %> ƒë</p>
        </div>
      <% }) %>
    </main>

    <!-- H√≥a ƒë∆°n -->
    <aside class="w-full sm:w-96 bg-white shadow-xl border-l rounded-tl-2xl flex flex-col">
      <div class="p-4 bg-blue-600 text-white font-semibold text-lg rounded-tl-2xl">
        üßæ H√≥a ƒë∆°n
      </div>
      <div id="bill" class="flex-1 p-4 overflow-y-auto">
        <p id="empty" class="text-gray-400 text-center mt-10">Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o</p>
      </div>

      <div class="border-t p-4 bg-gray-50">
        <div class="flex justify-between mb-2 text-lg">
          <span>T·ªïng ti·ªÅn:</span>
          <span id="total" class="font-bold text-blue-600">0 ƒë</span>
        </div>
        <button id="checkoutBtn" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold transition">
          ‚úÖ Thanh to√°n
        </button>
      </div>
    </aside>
  </div>

  <script>
    const bill = [];
    const billContainer = document.getElementById('bill');
    const totalEl = document.getElementById('total');
    const emptyEl = document.getElementById('empty');

    // ‚úÖ L·∫•y danh s√°ch s·∫£n ph·∫©m
    document.querySelectorAll('.product').forEach(el => {
      el.addEventListener('click', () => {
        const sp = {
          san_pham_id: +el.dataset.id,
          ten_san_pham: el.dataset.ten,
          gia_co_ban: +el.dataset.gia,
          ten_loai: el.dataset.loai
        };
        addToBill(sp);
      });
    });

    // ‚úÖ Th√™m s·∫£n ph·∫©m v√†o h√≥a ƒë∆°n
    function addToBill(sp) {
      const existing = bill.find(item => item.san_pham_id === sp.san_pham_id);
      if (existing) {
        existing.so_luong++;
      } else {
        bill.push({ ...sp, so_luong: 1 });
      }
      renderBill();
    }

    // ‚úÖ Hi·ªÉn th·ªã h√≥a ƒë∆°n
    function renderBill() {
      billContainer.innerHTML = '';
      if (bill.length === 0) {
        emptyEl.style.display = 'block';
      } else {
        emptyEl.style.display = 'none';
        bill.forEach((item, i) => {
          const div = document.createElement('div');
          div.className = 'flex justify-between items-center bg-gray-50 rounded-lg p-3 mb-2 shadow-sm';
          div.innerHTML = `
            <div class="flex-1">
              <p class="font-semibold text-gray-800">${item.ten_san_pham}</p>
              <p class="text-sm text-gray-500">${Number(item.gia_co_ban).toLocaleString()} ƒë</p>
            </div>
            <div class="flex items-center gap-2">
              <button class="px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 text-gray-700" onclick="changeQty(${i}, -1)">-</button>
              <span class="w-6 text-center">${item.so_luong}</span>
              <button class="px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 text-gray-700" onclick="changeQty(${i}, 1)">+</button>
              <button class="ml-2 text-red-500 hover:text-red-700" onclick="removeItem(${i})">üóëÔ∏è</button>
            </div>
          `;
          billContainer.appendChild(div);
        });
      }

      const total = bill.reduce((sum, item) => sum + item.gia_co_ban * item.so_luong, 0);
      totalEl.textContent = total.toLocaleString() + ' ƒë';
    }

    // ‚úÖ TƒÉng / gi·∫£m s·ªë l∆∞·ª£ng
    function changeQty(index, delta) {
      bill[index].so_luong += delta;
      if (bill[index].so_luong <= 0) bill.splice(index, 1);
      renderBill();
    }

    // ‚úÖ X√≥a s·∫£n ph·∫©m
    function removeItem(index) {
      bill.splice(index, 1);
      renderBill();
    }

    // ‚úÖ T√¨m ki·∫øm + L·ªçc
    const searchInput = document.getElementById('search');
    const filterSelect = document.getElementById('filter');
    searchInput.addEventListener('input', filterProducts);
    filterSelect.addEventListener('change', filterProducts);

    function filterProducts() {
      const keyword = searchInput.value.toLowerCase();
      const type = filterSelect.value;
      document.querySelectorAll('.product').forEach(div => {
        const name = div.dataset.ten.toLowerCase();
        const category = div.dataset.loai;
        const match = (!keyword || name.includes(keyword)) && (!type || category === type);
        div.style.display = match ? '' : 'none';
      });
    }

    // ‚úÖ Thanh to√°n
    document.getElementById('checkoutBtn').addEventListener('click', () => {
      if (bill.length === 0) return alert('Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o!');
      alert('Thanh to√°n th√†nh c√¥ng!');
      bill.length = 0;
      renderBill();
    });
  </script>
</body>
</html>
